{
    "collab_server" : "",
    "contents" : "setwd(\"~/Desktop/Project 2/world-university-ranking\")\n\n## global.R ##\nlibrary(dplyr)\nsource('helpers.r')\n\nschool_and_country_table = read.csv(\"./data/school_and_country_table.csv\", stringsAsFactors = F) %>%\n  rename(., university_name = school_name)\ncleanupCountry = read.csv(\"./data/cleanupCountry.csv\", stringsAsFactors = F)\ncleanupRename = read.csv(\"./data/cleanupRename.csv\", stringsAsFactors = F)\ncleanupCoord = read.csv(\"./data/cleanupCoord.csv\", stringsAsFactors = F)\n\n\ncwur = read.csv(\"./data/cwurData.csv\", stringsAsFactors = F) %>%\n  rename(., university_name = institution, total_score = score) %>%\n  mutate(., university_name = ifelse (grepl('^The ', university_name), \n                                      gsub('The ','',university_name), \n                                      university_name)) %>%\n  left_join(., cleanupRename, by = c('university_name')) %>%\n  mutate(., new_name = ifelse(is.na(new_name), university_name, new_name))\n\nshanghaiData = read.csv(\"./data/shanghaiData.csv\", stringsAsFactors = F) %>%\n  left_join(., rbind(school_and_country_table,cleanupCountry), by = c('university_name')) %>%\n  mutate(., university_name = ifelse (grepl('^The ', university_name), \n                                      gsub('The ','',university_name), \n                                      university_name)) %>%\n  left_join(., cleanupRename, by = c('university_name')) %>%\n  mutate(., new_name = ifelse(is.na(new_name), university_name, new_name))\n\ntimesData = read.csv(\"./data/timesData.csv\", stringsAsFactors = F) %>%\n  mutate(., university_name = ifelse (grepl('^The ', university_name), \n                                      gsub('The ','',university_name), \n                                      university_name)) %>%\n  left_join(., cleanupRename, by = c('university_name')) %>%\n  mutate(., new_name = ifelse(is.na(new_name), university_name, new_name),\n         international = as.numeric(international),\n         income = as.numeric(income),\n         total_score = as.numeric(total_score))\n\n#expenditure = read.csv(\"education_expenditure_supplementary_data.csv\", stringsAsFactors = F)\n#attainment = read.csv(\"educational_attainment_supplementary_data.csv\", stringsAsFactors = F)\n\nuniversities_year = unique(rbind(cwur[,c('new_name','country','year')],\n                     timesData[,c('new_name','country','year')],\n                     shanghaiData[,c('new_name','country','year')])) %>%\n  mutate(., country = gsub('Republic of Ireland', 'Ireland', country)) %>%\n  mutate(., country = gsub('USA','United States of America', country)) %>%\n  mutate(., country = gsub('Unisted States of America','United States of America', country)) %>%\n  mutate(., country = gsub('Unted Kingdom', 'United Kingdom', country)) %>%\n  mutate(., country = gsub('UK', 'United Kingdom', country)) %>%\n  mutate(., country = gsub('Slovak Republic', 'Slovakia', country)) %>%\n  mutate(., country = gsub('Russian Federation', 'Russia', country))\n\nuniversities_year = unique(universities_year) %>%\n  left_join(., cleanupCoord[,c('new_name','lon','lat')], by = c('new_name'))\n\nrankings = universities_year %>%\n  left_join(., cwur[,c('new_name','world_rank', 'year')], by = c('new_name', 'year')) %>%\n  left_join(., timesData[,c('new_name','world_rank', 'year')], by = c('new_name', 'year')) %>%\n  left_join(., shanghaiData[,c('new_name','world_rank', 'year')], by = c('new_name', 'year')) %>%\n  rename(., rank_cwur = world_rank.x, \n         rank_times = world_rank.y,\n         rank_shanghai = world_rank) %>%\n  mutate(., rank_times = gsub('=','',rank_times)) %>%\n  mutate(., rank_times = as.integer(sapply(rank_times, split_rank)),\n         rank_shanghai = as.integer(sapply(rank_shanghai, split_rank)))\n\nuniversities = unique(rankings[,c(1,2)])\n\ncountries = sort(unique(rankings$country))\n\ndf.2015.country = rankings[rankings$year==2015,] %>%\n  group_by(., country) %>%\n  summarise(., top_cwur = min(rank_cwur, na.rm=T), \n            top_times = min(rank_times, na.rm=T),\n            top_shanghai = min(rank_shanghai, na.rm=T),\n            median_cwur = round(median(rank_cwur, na.rm=T)),\n            median_times = round(median(rank_times, na.rm=T)),\n            median_shanghai = round(median(rank_shanghai, na.rm=T)),\n            count_cwur = sum(!is.na(rank_cwur)),\n            count_times = sum(!is.na(rank_times)),\n            count_shanghai = sum(!is.na(rank_shanghai)))\n\ndf.2015.uni = rankings %>%\n  filter(., year==2015 & !is.na(lon) & !is.na(lat)) ####---> Need to add more coordinates!!!!",
    "created" : 1462422893169.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "469279739",
    "id" : "DF998BFF",
    "lastKnownWriteTime" : 1462455409,
    "last_content_update" : 1462455409334,
    "path" : "~/Desktop/Project 2/world-university-ranking/global.R",
    "project_path" : "global.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}